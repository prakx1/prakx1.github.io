---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import { buildExcerpt, categoryToSlug, formatDate } from "../lib/content";

const notes = (await getCollection("blog", ({ data }) => !data.draft)).sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);

const latest = notes[0];
---

<BaseLayout activePath="/">
  <section class="hero-card">
    <p class="eyebrow">Personal blog</p>
    <h1>Simple notes from real engineering work.</h1>
    <p class="hero-copy">
      I wanted to write again. This is a clean space for backend lessons, design choices,
      debugging notes, and practical decisions from real projects.
    </p>

    <div class="hero-actions">
      {latest && <a class="button-main" href={`/notes/${latest.slug}/`}>Read latest note</a>}
      <a class="button-subtle" href="/about/">About me</a>
    </div>
  </section>

  <section class="section-header">
    <h2>Latest notes</h2>
    <a href="/feed.xml">Subscribe via RSS</a>
  </section>

  <section class="note-grid" aria-label="Blog notes">
    {notes.map((note) => (
      <article class="note-card">
        <p class="note-meta">{formatDate(note.data.date)}</p>
        <h3>
          <a href={`/notes/${note.slug}/`}>{note.data.title}</a>
        </h3>
        <p>{note.data.description ?? buildExcerpt(note.body, 180)}</p>
        <div class="chip-row">
          {note.data.categories.slice(0, 3).map((category) => (
            <a class="chip" href={`/category/${categoryToSlug(category)}/`}>
              {category}
            </a>
          ))}
        </div>
      </article>
    ))}
  </section>
</BaseLayout>
